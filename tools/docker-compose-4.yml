version: '2'
services:
  zookeeper:
    image: zookeeper
    ports:
      - 2181:2181
  master:
    build:
      context: ../
    volumes:
      - ../build:/usr/local/build
    depends_on:
      - "zookeeper"
    command: java -cp build/libs/ZDoop-all.jar org.iit.zserver.ZMaster m1
  worker-1:
    build:
      context: ../
    volumes:
      - ../build:/usr/local/build
    depends_on:
      - "master"
    command: java -cp build/libs/ZDoop-all.jar org.iit.zworker.ZWorker w1
  worker-2:
    build:
      context: ../
    volumes:
      - ../build:/usr/local/build
    depends_on:
      - "master"
    command: java -cp build/libs/ZDoop-all.jar org.iit.zworker.ZWorker w2
  worker-3:
    build:
      context: ../
    volumes:
      - ../build:/usr/local/build
    depends_on:
      - "master"
    command: java -cp build/libs/ZDoop-all.jar org.iit.zworker.ZWorker w3
  worker-4:
    build:
      context: ../
    volumes:
      - ../build:/usr/local/build
    depends_on:
      - "master"
    command: java -cp build/libs/ZDoop-all.jar org.iit.zworker.ZWorker w4
  client:
    build:
      context: ../
    volumes:
      - ../build:/usr/local/build
      - ../build/classes/java/main:/usr/local/bin
    depends_on:
      - "worker-1"
      - "worker-2"
      - "worker-3"
      - "worker-4"
    command: java -cp build/libs/ZDoop-all.jar org.iit.zclient.Client -f build/resources/main/1mb.txt